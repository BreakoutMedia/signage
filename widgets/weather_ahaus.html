<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Wetter â€“ Ahaus</title>
<style>
html, body {
  margin:0; height:100%; width:100%;
  background:#000 no-repeat center center fixed;
  background-size:cover;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  color:#fff; text-shadow: 0 2px 6px rgba(0,0,0,.8);
}
.container {display:flex;flex-direction:column;justify-content:space-between;height:100%;padding:40px 60px;box-sizing:border-box;}
header{display:flex;justify-content:space-between;align-items:center}
header h1{font-size:60px;margin:0}
.content{display:flex;justify-content:space-between;align-items:flex-start;gap:48px}
.left .label{font-size:44px}
.temp-row{display:flex;align-items:center;gap:20px;margin-top:8px}
.temp{font-size:160px;font-weight:800}
.icon{font-size:90px}
.feels{font-size:36px;margin-top:14px}
.right{max-width:820px}
.right h2{font-size:56px;margin:0}
.grid{margin-top:20px;display:grid;grid-template-columns:1fr 1fr;gap:20px 80px;font-size:34px}
footer{font-size:28px;opacity:.95}
.badge{font-size:28px; background:rgba(0,0,0,.35); padding:8px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.25)}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>Ahaus Wetter</h1>
    <div class="badge" id="updated">--:--</div>
  </header>
  <div class="content">
    <div class="left">
      <div class="label">Jetzt</div>
      <div class="temp-row">
        <div class="temp" id="temp">--Â°</div>
        <div class="icon" id="icon">â˜€ï¸</div>
      </div>
      <div class="feels" id="feels">GefÃ¼hlt --Â°</div>
    </div>
    <div class="right">
      <h2 id="cond">â€”</h2>
      <div class="grid">
        <div>Niederschlag:</div><div id="prec">â€” %</div>
        <div>Feuchtigkeit:</div><div id="humid">â€” %</div>
        <div>Wind:</div><div id="wind">â€” km/h</div>
        <div>LuftqualitÃ¤t:</div><div id="aqiText">â€”</div>
      </div>
    </div>
  </div>
  <footer>
    <span class="badge">Quelle: Open-Meteo</span>
  </footer>
</div>

<script>
// ==== Konfiguration (Ahaus) ====
const CITY='Ahaus', LAT=52.079, LON=6.965, REFRESH_MIN=10;

// ==== Wettercode â†’ Kategorie & Emoji ====
function wmoCategory(code){
  code = Number(code);
  if ([0,1].includes(code)) return 'clear';
  if ([2,3].includes(code)) return 'clouds';
  if ([45,48].includes(code)) return 'fog';
  if ([51,53,55,61,63,65,66,67,80,81,82].includes(code)) return 'rain';
  if ([71,73,75,77,85,86].includes(code)) return 'snow';
  if ([95,96,99].includes(code)) return 'thunder';
  return 'clouds';
}
function wmoText(code){
  const map={0:'Klar',1:'Ãœberwiegend klar',2:'Wolkig',3:'Bedeckt',45:'Nebel',48:'Nebel',
    51:'Niesel',53:'Niesel',55:'Niesel',61:'Regen',63:'Regen',65:'Starker Regen',
    66:'Gefrierender Regen',67:'Gefrierender Regen',71:'Schnee',73:'Schnee',75:'Starker Schnee',
    77:'SchneekÃ¶rner',80:'Schauer',81:'Schauer',82:'Starke Schauer',85:'Schneeschauer',
    86:'Starke Schneeschauer',95:'Gewitter',96:'Gewitter',99:'Gewitter'};
  return map[Number(code)] || 'Wetter';
}
function wmoEmoji(code, night=false){
  const e={0:night?'ğŸŒ™':'â˜€ï¸',1:night?'ğŸŒ™':'ğŸŒ¤ï¸',2:'â›…',3:'â˜ï¸',45:'ğŸŒ«ï¸',48:'ğŸŒ«ï¸',
           51:'ğŸŒ¦ï¸',53:'ğŸŒ¦ï¸',55:'ğŸŒ¦ï¸',61:'ğŸŒ§ï¸',63:'ğŸŒ§ï¸',65:'ğŸŒ§ï¸',66:'ğŸŒ§ï¸',67:'ğŸŒ§ï¸',
           71:'ğŸŒ¨ï¸',73:'ğŸŒ¨ï¸',75:'â„ï¸',77:'â„ï¸',80:'ğŸŒ¦ï¸',81:'ğŸŒ¦ï¸',82:'ğŸŒ§ï¸',95:'â›ˆï¸',96:'â›ˆï¸',99:'â›ˆï¸'};
  return e[Number(code)] || 'â˜ï¸';
}

// ==== LuftqualitÃ¤t grob (PM2.5) ====
function pm25ToText(pm){ if(pm==null) return 'â€”'; if(pm<=12) return 'Gut'; if(pm<=35.4) return 'Mittel'; return 'Schlecht'; }

// ==== Hintergrund je Wetter (optional Night-Variante) ====
function pickBackground(cat, isNight){
  // Dateien, die du neben diese HTML legst:
  // bg_clear.jpg, bg_clouds.jpg, bg_rain.jpg, bg_snow.jpg, bg_thunder.jpg, bg_fog.jpg
  // Optional: bg_clear_night.jpg etc.
  const base = {
    clear:   'bg_clear.jpg',
    clouds:  'bg_clouds.jpg',
    rain:    'bg_rain.jpg',
    snow:    'bg_snow.jpg',
    thunder: 'bg_thunder.jpg',
    fog:     'bg_fog.jpg'
  };
  if (isNight) {
    const nightCandidate = base[cat].replace('.jpg','_night.jpg');
    // Wir versuchen erst Nachtbild, fallback auf Tag
    return nightCandidate;
  }
  return base[cat];
}
function setBackground(url){
  // Preload & dann setzen (vermeidet Flackern)
  const img = new Image();
  img.onload = ()=>{ document.documentElement.style.backgroundImage = `url('${url}')`; };
  img.src = url;
}

// ==== Daten laden & UI setzen ====
async function loadData(){
  const wURL=`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current_weather=true&hourly=temperature_2m,apparent_temperature,relative_humidity_2m,precipitation_probability,weathercode,windspeed_10m&timezone=auto`;
  const aURL=`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${LAT}&longitude=${LON}&hourly=pm2_5&timezone=auto`;
  const [wr, ar] = await Promise.all([fetch(wURL,{cache:'no-store'}), fetch(aURL,{cache:'no-store'})]);
  const weather = await wr.json(); const air = await ar.json();

  const cw = weather.current_weather || {};
  const h  = weather.hourly || {};
  let idx = 0;
  if (h.time && h.time.length){
    const iso = new Date().toISOString().slice(0,13);
    idx = h.time.findIndex(t => t.slice(0,13) === iso);
    if (idx < 0) idx = h.time.length - 1;
  }

  const temp  = Math.round(cw.temperature ?? h.temperature_2m?.[idx] ?? 0);
  const feels = Math.round(h.apparent_temperature?.[idx] ?? temp);
  const hum   = Math.round(h.relative_humidity_2m?.[idx] ?? 0);
  const prec  = Math.round(h.precipitation_probability?.[idx] ?? 0);
  const wind  = Math.round(cw.windspeed ?? h.windspeed_10m?.[idx] ?? 0);
  const code  = cw.weathercode ?? h.weathercode?.[idx] ?? 3;

  // Nacht?
  const hour = new Date().getHours();
  const isNight = (hour < 6 || hour >= 21);

  // UI
  document.getElementById('temp').textContent  = temp + 'Â°';
  document.getElementById('feels').textContent = 'GefÃ¼hlt ' + feels + 'Â°';
  document.getElementById('cond').textContent  = wmoText(code);
  document.getElementById('prec').textContent  = (prec ?? 0) + ' %';
  document.getElementById('humid').textContent = (hum ?? 0) + ' %';
  document.getElementById('wind').textContent  = (wind ?? 0) + ' km/h';
  document.getElementById('icon').textContent  = wmoEmoji(code, isNight);
  document.getElementById('updated').textContent = new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});

  // AQI
  let pm25 = null;
  if (air?.hourly?.pm2_5){
    let aidx = 0;
    if (air.hourly.time){
      const iso = new Date().toISOString().slice(0,13);
      aidx = air.hourly.time.findIndex(t => t.slice(0,13) === iso);
      if (aidx < 0) aidx = air.hourly.time.length - 1;
    }
    pm25 = air.hourly.pm2_5[aidx];
  }
  document.getElementById('aqiText').textContent = pm25ToText(pm25);

  // Hintergrund
  const cat = wmoCategory(code);
  let bg = pickBackground(cat, isNight);
  // Fallback, falls Night-Datei nicht existiert: versuche Day-Datei
  const testImg = new Image();
  testImg.onload = ()=> setBackground(bg);
  testImg.onerror = ()=> setBackground(pickBackground(cat, false));
  testImg.src = bg;
}

loadData();
setInterval(loadData, REFRESH_MIN * 60 * 1000);
</script>
</body>
</html>
