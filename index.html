<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Breakout Media Signage</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    background: #000;
    overflow: hidden;
  }
  video {
    width: 100vw;
    height: 100vh;
    object-fit: cover;
    background: #000;
  }
</style>
</head>
<body>
<video id="player" autoplay muted playsinline></video>

<script>
const manifestUrl = 'manifests/ahaus.json'; // Passe ggf. den Pfad an
let spots = [];
let currentIndex = 0;
let refreshInterval = 15 * 60 * 1000; // alle 15 Minuten
let player = document.getElementById('player');

async function fetchManifest() {
  try {
    const res = await fetch(manifestUrl + '?t=' + Date.now(), { cache: 'no-cache' });
    if (!res.ok) throw new Error('Manifest konnte nicht geladen werden');
    const data = await res.json();
    if (JSON.stringify(data.spots) !== JSON.stringify(spots)) {
      console.log('[INFO] Manifest geändert, aktualisiere Spots...');
      spots = data.spots;
      currentIndex = 0;
      if (spots.length > 0) playCurrent();
    } else {
      console.log('[INFO] Manifest unverändert');
    }
  } catch (err) {
    console.error('[ERROR] Manifest-Load:', err);
  }
}

function playCurrent() {
  if (spots.length === 0) {
    console.warn('Keine Spots verfügbar.');
    return;
  }
  const spot = spots[currentIndex];
  console.log('[PLAY]', spot.src);
  player.src = spot.src;
  player.play().catch(err => console.error('Play-Error:', err));
}

player.addEventListener('ended', () => {
  currentIndex = (currentIndex + 1) % spots.length;
  playCurrent();
});

// Initial laden
fetchManifest().then(() => {
  if (spots.length > 0) playCurrent();
});

// Regelmäßiges Aktualisieren des Manifests
setInterval(fetchManifest, refreshInterval);
</script>
</body>
</html>
